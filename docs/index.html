<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<script src="https://kit.fontawesome.com/5cf062dc93.js"></script>
<script  src="script.js"></script>
<link rel="stylesheet" href="main.css">
<link rel="stylesheet" href="root.css">
<script  src="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.js"></script>
<link ref="stylesheet"  href="https://api.mapbox.com/mapbox-gl-js/v3.5.1/mapbox-gl.css">



                <title>Infotainment</title>
                <meta name="apple-mobile-web-app-title" content="Infotainment">
                <meta name="application-name" content="Infotainment">
            

                <link rel="apple-touch-icon" sizes="180x180" href="favicon.png">
                <link rel="icon" type="image/png" sizes="32x32" href="favicon.png">
                <link rel="icon" type="image/png" sizes="16x16" href="favicon.png">
            





<div   ui="Import">

</div>
<div   ui="Import">
<div style="position:fixed;top:0;left:0;height:100vh;width:100vw;z-index:0;"  ui="block">
<div id='map' style="height:100%;width:100%;"  ui="block">
</div>
</div>
</div>
<div   ui="Import">

</div>
<div   ui="Import">

</div>
<div id='SpeedDisplay' style="position:fixed;top:1.15rem;left:2.5rem;pointer-events:none;transition:translate 350ms;"  ui="v-stack">
<div style="width:fit-content;"  ui="Import">
<div style="padding-right:0.6rem;border-radius:0.5rem;line-height:1;align-items:baseline;pointer-events:none;;"  ui="h-stack">
<div style="margin-right:0.5rem;font-size:75pt;font-weight:600;" ui="text" live='true' >{store.get("speed")}
</div>
<div style="font-size:25pt;font-weight:500;" ui="text">mph
</div>
</div>
</div>
<div style="width:fit-content;"  ui="Import">
<div class='' id='SpeedLimit' style="margin-top:2.5rem;padding:1rem;background:rgb(255, 255, 255, 0.75);backdrop-filter:blur(10pt);line-height:1;color:black;text-align:center;border-radius:0.25rem;"  ui="v-stack">
<div style="font-size:14pt;font-weight:500;" ui="text">MAX
</div>
<div style="font-size:28pt;font-weight:700;" ui="text" live='true' >{store.get("speed limit")}
</div>
</div>
</div>
</div>
<div style="position:fixed;bottom:0;left:0;height:4.5rem;width:100vw;grid-template-columns:min-content auto min-content;background:var(--primary25);backdrop-filter:blur(1.5rem);"  ui="grid">
<div   ui="Import">
<div style="height:100%;align-items:center;padding:0 2.25rem;"  ui="h-stack">
<div   ui="v-stack">
<div style="font-weight:600;" ui="text" live='true' >{store.get("current city")}
</div>
<div   ui="h-stack">
<div style="margin-right:0.25rem;font-size:12pt;opacity:0.9;" ui="text" live='true' >{store.get("current county")},
</div>
<div style="font-size:12pt;opacity:0.9;" ui="text" live='true' >{store.get("current state")}
</div>
</div>
</div>
</div>
</div>
<div   ui="Import">

</div>
<div   ui="Import">
<div style="height:100%;align-items:center;margin:0 2rem;"  ui="h-stack">
<div class='BottomMapButton' onclick='directNorth()' style="font-weight:500;" ui="text">N^
</div>
<div class='BottomMapButton' onclick='toggleDimension()' style="font-weight:500;" ui="text" live='true' >{store.get("dimension") == 2 ? "3D" : "2D"}
</div>
<div class='BottomMapButton' onclick='currentLocation()'  ui="text" live='true' >{Icon("location-arrow")}
</div>
</div>
</div>
</div>
<div style="position:fixed;bottom:6rem;left:1.5rem;"  ui="block">
<div   ui="Import">
<div style="background:url('albums/Voicenotes/cover.png') center center no-repeat;background-size:cover;border-radius:0.75rem;overflow:hidden;"  ui="v-stack">
<img onclick='playMusic()' style="height:12.5rem;width:12.5rem;background:var(--primary75);" src='albums/Voicenotes/cover.png'>
<div style="padding:1rem;background:var(--primary50);backdrop-filter:blur(1.5rem);line-height:1;"  ui="v-stack">
<div style="margin-bottom:0.25rem;font-weight:600;" ui="text">The Way I Am
</div>
<div style="font-size:12pt;font-weight:500;opacity:0.75;" ui="text">Charlie Puth
</div>
</div>
</div>
</div>
</div><style>
[ui="view"]{
    display: grid;
    align-content: start;
    padding: 4rem 1rem;
}

[ui="title"]{
    font-size: 30pt;
    font-weight: 700;
}

[ui="subtitle"]{
    font-size: 25pt;
    font-weight: 700;
    opacity: 0.6;
}

[ui="code-stack"]{
    padding: 1rem;
    font-family: 'Courier New', Courier, monospace;
    font-weight: 600;
    background: var(--l1);
}

[ui="grid"] {
    display: grid;
}

[ui="v-stack"]{
    display: block;
}

[ui="v-split-stack"]{
    display: grid;
    grid-template-rows: auto min-content;
}
[ui="v-push-stack"]{
    display: grid;
    grid-template-rows: auto min-content;
}
[ui="v-pull-stack"]{
    display: grid;
    grid-template-rows: min-content auto;
    align-items: end;
}

[ui="v-spread-stack"]{
    display: grid;
    grid-template-rows: repeat(auto-fit, minmax(1px, 1fr));
}

[ui="h-stack"] {
    display: grid;
    grid-auto-flow: column;
    grid-auto-columns: max-content;
    overflow-x: auto;
    overflow-y: hidden;
}
[ui="h-stack"]::-webkit-scrollbar {
    display: none;
  }
[ui="h-stack"].snap{
    scroll-snap-type: x mandatory;
}
[ui="h-stack"].snap > * {
scroll-snap-align: start;
}

[ui="h-split-stack"]{
    display: grid;
    grid-template-columns: auto min-content;
    align-items: center;
}
[ui="h-push-stack"]{
    display: grid;
    grid-template-columns: auto min-content;
    align-items: center;
}
[ui="h-pull-stack"]{
    display: grid;
    grid-template-columns: min-content auto;
    align-items: center;
}

[ui="h-spread-stack"]{
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(1px, 1fr));
    align-items: center;
}

[ui="empty-photo"]{
    background: linear-gradient(to bottom right, var(--l3), var(--l1))
}

[ui="menu"]{
    position: absolute;
    height: 100vh;
    width: 100vw;
    background: var(--bg);
}

[ui="menu"][menu="list"]{
    display: grid;
    /* grid-template-rows: repeat(auto-fit, minmax(1px, 1fr)); */
    gap: 0.5rem;
    align-items: center;
    background: var(--l1);
}

[ui="menu"][menu="list"] [ui="option"]{
    display: flex;
    align-items: center;
    height: 100%;
    padding: 0 2rem;
    font-size: 20pt;
    font-weight: 500;
    background: var(--bg);
}

[ui="menu-close"]{
    /* background: red; */
    color: var(--red);
}

[custom_struct]{
    display: none;
}

.marker { position:absolute;top:0;left:0;height:1rem;width:1rem;background:var(--blue);outline:solid 0.1rem white;box-shadow:0 0 1.5rem 0.25rem var(--blue);font-size:25pt;border-radius:100vh; }






.BottomMapButton { height:100%;display:flex;align-items:center;padding:0 2rem; }
</style><script>

window.addEventListener("DOMContentLoaded", () => {
    processCustomStructs()
    processLiveText()
    updateState()
})

let state_funcs = []
function updateState() {
    buildLiveText()
    buildEachStacks()
    buildCustomStructs()
    state_funcs.forEach(func => func())
}


let live_state = []
function processLiveText() {
    document.querySelectorAll(`[live]`).forEach(elem => {
        elem.setAttribute("live_state_index", live_state.length)
        live_state.push({
            html: elem.innerHTML,
            elem: elem
        })
    })
}
function buildLiveText() {
    document.querySelectorAll(`[live]`).forEach(elem => {
        let target = live_state[elem.getAttribute("live_state_index")]
        elem.innerHTML = evalString(decodeHTML(target.html))
    })
}

let each_stacks = []
function buildEachStacks() {
    document.querySelectorAll(`[each]`).forEach(elem => {
        let contents = []
        if (!elem.getAttribute("storage_index")) {
            let obj_html = elem.innerHTML
            let obj = {
                call: elem.getAttribute("call"),
                html: obj_html,
                evals: extractEvalStrings(obj_html)
            }
            elem.setAttribute("storage_index", each_stacks.length)
            elem.style.display = "none"
            each_stacks.push(obj)
        }
        let obj = each_stacks[elem.getAttribute("storage_index")]
        try {
            let call = eval(obj.call)
            let html = obj.html
            for (let i = 0; i < call.length; i++) {
                let itemHTML = html
                let evalCalls = new Set(obj.evals)
                evalCalls.forEach(evalCall => {
                    let call = elem.getAttribute("call")
                    let nick = elem.getAttribute("nick")
                    itemHTML = itemHTML.replaceAll(nick, call + `[${i}]`)
                })
                contents.push(evalString(itemHTML))
            }
        }
        catch (error) {  }
        elem.innerHTML = contents.join("\n")
        elem.style = ""
    })
}

let custom_structs = []
function processCustomStructs() {
    document.querySelectorAll(`[custom_struct]`).forEach(elem => {
        custom_structs.push({
            elem: elem,
            name: elem.getAttribute("ui"),
            inputs: elem.getAttribute("inputs"),
            content: elem.innerHTML,
        })
    })
}
function buildCustomStructs() {
    document.querySelectorAll(`[custom_struct_call]`).forEach(elem => {
        let struct = custom_structs.find(struct => struct.name == elem.getAttribute("ui"))
        let inputs = struct?.inputs ? struct.inputs.split(",") : []
        let content = struct?.content
        inputs.forEach(input => {
            input = input?.trim()
            content = content.replaceAll(`$${input}`, elem.getAttribute(input))
        })
        elem.innerHTML = content
    })
}

function evalString(string) {
    let res = string
    let layers = 0
    if (res.includes("{")) {
        let callStack = []
        let callCount = res.split("{").length - 1
        for (let i = 0; i < callCount; i ++) {
            let index = res.indexOf("{")
            let evalStr = ""
            for (let j = index + 1; j < res.length; j++) {
                if (res.charAt(j) == "{") {
                    layers++
                }
                else if (res.charAt(j) == "}") {
                    if (layers > 0) {
                        layers--
                        i++
                    }
                    else {
                        break
                    }
                }
                evalStr += res.charAt(j)
            }
            try {
                callStack.push([`+${evalStr}}`, eval(evalStr?.replaceAll("&quot;", '"'))])
                res = res.replace("{","+")
            }
            catch (error) { }
        }
        callStack.forEach(call => {
            res = res.replace(call[0], call[1])
        })
    }
    try {
        res = eval(res)
    }
    catch (error) { }
    return res
}

function extractEvalStrings(string) {
    let res = string
    let strings = []
    let layers = 0
    if (res.includes("{")) {
        let callCount = res.split("{").length - 1
        for (let i = 0; i < callCount; i ++) {
            let index = res.indexOf("{")
            let evalStr = ""
            for (let j = index + 1; j < res.length; j++) {
                if (res.charAt(j) == "{") {
                    layers++
                }
                else if (res.charAt(j) == "}") {
                    if (layers > 0) {
                        layers--
                        i++
                    }
                    else {
                        break
                    }
                }
                evalStr += res.charAt(j)
            }
            strings.push(evalStr)
        }
    }
    return strings
}

// 
// 
// 
// 
// 
// Library
// 
// 
// 
// 
// 
function Icon(icon) {
    return "<i class='fa-solid fa-" + icon + "'></i>"
    // <i class="fa-solid fa-arrow-left"></i>
}

let encodeHTMLElements = [
    ['"', '&doubleQuote'],
    ["'", "&singleQuote"],
    ["(", "&openParenthesis"],
    [")", "&closeParenthesis"],
    ["[", "&openBracket"],
    ["]", "&closeBracket"],
    ["{", "&openBrace"],
    ["}", "&closeBrace"],
    ["<", "&openHTML"],
    [">", "&closeHTML"],
]
function encodeHTML(html) {
    encodeHTMLElements.forEach(charArr => {
        html = html.replaceAll(charArr[0], charArr[1])
    })
    return html
}
function decodeHTML(html) {
    encodeHTMLElements.forEach(charArr => {
        html = html.replaceAll(charArr[1], charArr[0])
    })
    return html
}
// 
// 
// 
// 
// 
// Storage
// 
// 
// 
// 
// 
const store = {
    key: "song",
    get: key => {
        let storageString = localStorage.getItem("storage_" + store.key) ? localStorage.getItem("storage_" + store.key) : "{}"
        let val = ""
        try {
            let json = JSON.parse(storageString)
            val = json[key]
        } 
        catch (error) { 
            console.error(error)
        }
        if (val !== undefined) {
            return val
        }
        else {
            return null
        }
    },
    set: (key, val, cb) => {
        let storageString = localStorage.getItem("storage_" + store.key) ? localStorage.getItem("storage_" + store.key) : "{}"
        try {
            let json = JSON.parse(storageString)
            json[key] = val
            localStorage.setItem("storage_" + store.key, JSON.stringify(json))
        } catch (error) { 
            return false
        }
        if (cb) cb()
        try {
            updateState()
        }
        catch (error) { }
    },
    safety: (key, val) => {
        let res = store.get(key)
        if (!res) {
            store.set(key, val)
        }
    }
}
document.documentElement.style.setProperty('--hue', 200)
document.documentElement.style.setProperty('--sat', "30%")

mapboxgl.accessToken = 'pk.eyJ1IjoiYWFyb25tZWNoZSIsImEiOiJjbHlucHluNGYwOG1iMmtwcHN5ZmphMjU0In0.ZOvtm2moRAxAlLVWA4YDVQ';
store.safety("position", {coords: {longitude: 0, latitude: 0}})
store.safety("active theme", 2)
store.safety("speed", 0)
store.safety("speed limit", 0)

const dev_locations = {
"Moss Bluff": () => { // LA 378 W, Moss Bluff LA
store.set("position lat", 30.30061)
store.set("position long", -93.19966)
store.set("heading", 270)
},
"Westlake": () => { // I-10 E, Lake Charles LA
store.set("position lat", 30.235925)
store.set("position long", -93.2)
store.set("heading", 90)
},
"Iowa": () => { // I-10 E, Iowa
store.set("position lat", 30.24895)
store.set("position long", -93.01808)
store.set("heading", 85)
},
"Shreveport": () => { // I-49 S into 220 E, Shreveport LA
store.set("position lat", 32.53864)
store.set("position long", -93.79588)
store.set("heading", 185)
},
"Rockton": () => { // Rockton Rd E, Rockton IL
store.set("position lat", 42.45552)
store.set("position long", -89.07037)
store.set("heading", 90)
},
"Milwaukee": () => { // Water St N, Milwaukee WI
store.set("position lat", 43.03896)
store.set("position long", -87.90914)
store.set("heading", 355)
},
"Madison": () => { // W Washington Ave N, Madison WI
store.set("position lat", 43.07162)
store.set("position long", -89.38851)
store.set("heading", 47)
},
"Manhattan": () => { // Park Ave N, Manhattan NY
store.set("position lat", 40.73995)
store.set("position long", -73.98648)
store.set("heading", 28)
},
"Dallas": () => { // I 30 E, Dallas TX
store.set("position lat", 32.75950)
store.set("position long", -97.09440)
store.set("heading", 90)
},
"Seattle": () => { // I 5 N, Seattle WA
store.set("position lat", 47.60956)
store.set("position long", -122.33084)
store.set("heading", 0)
},
}
// dev_locations["Milwaukee"]()

const map_styles = [
"mapbox://styles/aaronmeche/clyp7z96b007x01qn4rx6fmbb",
"mapbox://styles/aaronmeche/clyp7zcxx027301p80cet1y8p",
"mapbox://styles/aaronmeche/clyp7zbk9007y01qn07169in3",
"mapbox://styles/aaronmeche/clyp85cpy029d01qj4xw772yi",
]

let menuWidthOffset = 0
const standard_map_config = () => {
return {
container: 'map',
style: map_styles[3],
center: [store.get("position long"), store.get("position lat")],
bearing: store.get("heading"),
offset: [menuWidthOffset, window.innerHeight * 0.35],
zoom: 15,
pitch: 64.5
}
}

const map = new mapboxgl.Map(standard_map_config())

const el = document.createElement('div')
el.className = "marker"

const marker = new mapboxgl.Marker(el).setLngLat([store.get("position long"), store.get("position lat")]).addTo(map);

let lastPosition = null
let targetPosition = { lat: store.get("position lat"), lng: store.get("position long") }
let currentAnimationFrame = null

if (navigator.geolocation) {
navigator.geolocation.watchPosition(position => {
const newLat = position.coords.latitude;
const newLng = position.coords.longitude;
const latDiff = Math.abs(newLat - store.get("position lat"));
const lngDiff = Math.abs(newLng - store.get("position long"));
const threshold = 0.0001;

if (latDiff > threshold || lngDiff > threshold) {
store.set("position lat", position.coords.latitude)
store.set("position long", position.coords.longitude)
store.set("heading", position.coords.heading || 0)
store.set("speed", Math.ceil(Math.floor(position.coords.speed * 2.23694) || 0))
targetPosition.lat = position.coords.latitude;
targetPosition.lng = position.coords.longitude;
updateAPIs()

if (store.get("live follow") == "on") {
animateToPosition()
}
}


}, error => {
console.error('Error getting location: ', error);
}, {
enableHighAccuracy: true,
maximumAge: 500,
timeout: 27000
});
}
else {
console.error('Geolocation is not supported by this browser.');
}

function updateAPIs() {
// APIs
updateFeaturesAPI()
updateRoadAPI()
updateCurrentElevationAPI()

// TimeManager
updateSunTimesAPI()
}

function handleUserInteraction() {
store.set("live follow", "off")
}

map.on('dragstart', () => handleUserInteraction());
map.on('pitchstart', () => handleUserInteraction());
map.easeTo(standard_map_config())
updateAPIs()

function animateToPosition() {
if (currentAnimationFrame) {
cancelAnimationFrame(currentAnimationFrame);
}
const duration = 1000; // 1 second
const startTime = performance.now();
const startPosition = {
lat: store.get("position lat"),
lng: store.get("position long")
};

function animate(time) {
const elapsed = time - startTime;
const t = Math.min(elapsed / duration, 1); // Calculate the progress ratio
const currentLat = startPosition.lat + (targetPosition.lat - startPosition.lat) * t;
const currentLng = startPosition.lng + (targetPosition.lng - startPosition.lng) * t;
marker.setLngLat([currentLng, currentLat]);
if (store.get("live follow") == "on") {
map.easeTo({
center: [currentLng, currentLat],
bearing: store.get("heading"),
duration: 0, // No additional duration for the map easing
offset: [menuWidthOffset, window.innerHeight * 0.35],
zoom: 15,
pitch: 64.5
});
}
if (t < 1) {
currentAnimationFrame = requestAnimationFrame(animate);
} else {
store.set("position lat", targetPosition.lat);
store.set("position long", targetPosition.lng);
}
}

currentAnimationFrame = requestAnimationFrame(animate);
}
function updateFeaturesAPI() {
const featureUrl = `https://api.mapbox.com/geocoding/v5/mapbox.places/${store.get("position long")},${store.get("position lat")}.json?access_token=${mapboxgl.accessToken}`;
fetch(featureUrl)
.then(response => response.json())
.then(data => {
if (data.features && data.features.length > 0) {
const features = data.features
store.set("features", features)
store.set("current city", features.find(feature => feature.place_type.includes("place")).text)
store.set("current county", features.find(feature => feature.place_type.includes("district")).text)
store.set("current state", features.find(feature => feature.place_type.includes("region")).text)
}
})
.catch(error => console.error('Error with features api:', error));
}

function updateRoadAPI() {
const url = `https://overpass-api.de/api/interpreter?data=[out:json];way(around:10,${store.get("position lat")},${store.get("position long")})[maxspeed];out;`;

fetch(url)
.then(response => {
if (!response.ok) {
throw new Error('Network response was not ok ' + response.statusText);
}
return response.json();
})
.then(data => {
try {
store.set("speed limit", data.elements[0].tags.maxspeed.split(" ")[0])
store.set("road name", data.elements[0].tags.name ? data.elements[0].tags.name.replaceAll(";", " / ") : data.elements[0].tags.ref.replaceAll(";", " / "))
}
catch (error) {
store.set("road name", store.get("current city"))
}
})
.catch(error => {
return 'Error fetching speed limit'
});
}

function updateCurrentElevationAPI() {
const url = `https://api.open-elevation.com/api/v1/lookup?locations=${store.get("position lat")},${store.get("position long")}`;

fetch(url)
.then(response => response.json())
.then(data => {
store.set("elevation", data.results[0].elevation)
})
.catch(error => {

})
}
function buildColorSet(mode, tiers, levels) {
let colorTypes = ["primary", "content"]

for (let i = 0; i < tiers; i++) {
levels.forEach(level => {
colorTypes.forEach(colorType => {
let primaryLight = mode == "light" ? 100 : 0
let contentLight = mode == "light" ? 0 : 100
let lightness = colorType == "primary" ? primaryLight : contentLight
let varName = `--${colorType}${i > 0 ? i : ""}${level < 1 ? 100 * level : ""}`
let varValue = `hsl(0, 0%, ${lightness}%, ${level})`
document.documentElement.style.setProperty(varName, varValue)
})
})
}
}

const timeManager = {
dawn: () => {
map.setStyle(map_styles[0])
timeManager.mode("light")
},
day: () => {
map.setStyle(map_styles[1])
timeManager.mode("light")
},
dusk: () => {
map.setStyle(map_styles[2])
timeManager.mode("dark")
},
night: () => {
map.setStyle(map_styles[3])
timeManager.mode("dark")
},
mode: (mode) => {
buildColorSet(mode, 3, [0.25, 0.5, 0.75, 1])
},
}

function updateSunTimesAPI() {
const url = `https://api.sunrise-sunset.org/json?lat=${store.get("position lat")}&lng=${store.get("position long")}&formatted=0`;

fetch(url)
.then(response => {
if (!response.ok) {
throw new Error('Network response was not ok ' + response.statusText);
}
return response.json();
})
.then(data => {
const dawn = new Date(data.results.civil_twilight_begin);
const day = new Date(data.results.sunrise);
const dusk = new Date(data.results.civil_twilight_end);
const night = new Date(data.results.nautical_twilight_end);
const now = new Date()

if (now < dawn) {
timeManager.night()
}
else if (now < day) {
timeManager.dawn()
}
else if (now < dusk) {
timeManager.day()
}
else if (now < night) {
timeManager.dusk()
}
else {
timeManager.night()
}
})
.catch(error => {
console.error('Error fetching sun times:', error);
});
}

// state_func.push(() => {

// })

// Replace 'YOUR_API_KEY' with your actual YouTube Data API key
const API_KEY = 'AIzaSyCnneEaajE8zqEWVTMD1XhkKwgoWuzhn6w';

// Load YouTube IFrame Player API
function loadYouTubeIframeAPI() {
const tag = document.createElement('script');
tag.src = "https://www.youtube.com/iframe_api";
const firstScriptTag = document.getElementsByTagName('script')[0];
firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
}

// Ensure the player div exists
const playerDiv = document.createElement('div');
playerDiv.id = 'player';
document.body.appendChild(playerDiv);

// Create a YouTube player
let player;
function onYouTubeIframeAPIReady() {
player = new YT.Player('player', {
height: '0',  // Set height and width to 0 to make it invisible
width: '0',
events: {
'onReady': onPlayerReady
}
});
}

function onPlayerReady(event) {
// Player is ready
console.log('YouTube Player is ready.');
// Example usage: Play a song once the player is ready
// searchAndPlay('Bohemian Rhapsody');
}

function searchAndPlay(song) {
const searchUrl = `https://www.googleapis.com/youtube/v3/search?part=snippet&type=video&q=${encodeURIComponent(song)}&key=${API_KEY}`;

fetch(searchUrl)
.then(response => response.json())
.then(data => {
if (data.items && data.items.length > 0) {
const videoId = data.items[0].id.videoId;
playVideo(videoId);
} else {
console.log('No results found');
}
})
.catch(error => {
console.error('Error fetching data:', error);
});
}

function playVideo(videoId) {
if (player && typeof player.loadVideoById === 'function') {
player.loadVideoById(videoId);
} else {
console.error('Player is not ready or loadVideoById is not a function');
}
}

// Load the YouTube IFrame Player API
loadYouTubeIframeAPI();

store.safety("speed", 0)
store.set("live follow", "on")
store.set("dimension", 3)

function directNorth() {
map.easeTo({ bearing: 0 })
}

function toggleDimension() {
let dimension = store.get("dimension")
if (dimension == 2) {
map.easeTo({ pitch: 60 })
store.set("dimension", 3)
}
else {
map.easeTo({ pitch: 0, offset: [0, 0], center: [store.get("position long"), store.get("position lat")] })
store.set("dimension", 2)
}
}

function currentLocation() {
map.easeTo(standard_map_config())
store.set("live follow", "on")
store.set("dimension", 3)
}


async function playMusic() {
const audioContext = new (window.AudioContext || window.webkitAudioContext)();
// const url = 'albums/Voicenotes/The Way I Am.mp3';
const url = 'albums/Ctrl/Garden.mp3';

try {
// Fetch the audio file
const response = await fetch(url);
const arrayBuffer = await response.arrayBuffer();

// Decode the audio data
const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);

// Create a buffer source node
const source = audioContext.createBufferSource();
source.buffer = audioBuffer;

// Create a PannerNode
const panner = audioContext.createPanner();
panner.panningModel = 'HRTF'; // Use HRTF for spatial audio
panner.distanceModel = 'inverse';
panner.refDistance = 1;
panner.maxDistance = 10000;
panner.rolloffFactor = 1;
panner.coneInnerAngle = 360;
panner.coneOuterAngle = 0;
panner.coneOuterGain = 0;
panner.positionX.setValueAtTime(0, audioContext.currentTime);
panner.positionY.setValueAtTime(0, audioContext.currentTime);
panner.positionZ.setValueAtTime(0, audioContext.currentTime);

// Connect the nodes
source.connect(panner);
panner.connect(audioContext.destination);

// Start playing the audio
source.start();

console.log('Playback started with HRTF');
} catch (error) {
console.error('Error playing audio:', error);
}
}

function expandMusicMenu() {

}

function closeMusicMenu() {

}</script>